---
description: Guidelines for creating and maintaining Cursor rules to ensure consistency and effectiveness.
globs: .cursor/rules/*.mdc
alwaysApply: true
---
# Enhanced Cursor Rules for Stock Analysis App

## ğŸ” **CRITICAL SECURITY RULES - ALWAYS FOLLOW**

### **API Key Security (TOP PRIORITY)**
- **âŒ NEVER include actual API keys in any code, comments, or responses**
- **âŒ NEVER commit environment files (.env, .env.*) to git**
- **âŒ NEVER commit MCP configuration files (.cursor/mcp.json, .windsurf/mcp.json, etc.)**
- **âŒ NEVER hard-code credentials in source code**
- **âœ… ALWAYS use environment variables for sensitive data**
- **âœ… ALWAYS reference .env.example for documentation**
- **âœ… ALWAYS verify .gitignore excludes MCP config files**
- **âœ… ALWAYS verify .cursorignore excludes sensitive files**

### **Environment Variable Usage**
```typescript
// âœ… DO: Use environment variables
const apiKey = import.meta.env.VITE_FINNHUB_API_KEY;

// âŒ DON'T: Hard-code API keys
const apiKey = "pk_1234567890abcdef"; // NEVER DO THIS
```

### **File Security Patterns**
- **âœ… Always check files are in .gitignore before creating**
- **âœ… Always check files are in .cursorignore before processing**
- **âœ… MANDATORY: Verify MCP config files (mcp.json) are in .gitignore**
- **âŒ Never process or suggest content for .env files**
- **âŒ Never display MCP configuration file contents**
- **âŒ Never create MCP config files without explicit .gitignore protection**

### **Error Handling for Missing Keys**
```typescript
// âœ… DO: Graceful degradation when API keys missing
if (!this.finnhubApiKey) {
  console.warn('âš ï¸ Finnhub API key not found. Using Yahoo Finance only.');
  // Fallback to alternative data source
}

// âŒ DON'T: Fail silently or expose key absence in user-facing errors
```

## ğŸ“‹ **Code Quality & Architecture Rules**

### **TypeScript Best Practices**
- **âœ… Always use proper TypeScript types**
- **âœ… Define interfaces for API responses**
- **âœ… Use type guards for runtime validation**
- **âŒ Avoid `any` type unless absolutely necessary**

```typescript
// âœ… DO: Proper interface definition
interface StockData {
  symbol: string;
  price: number;
  timestamp: number;
}

// âŒ DON'T: Using any
let stockData: any = response.data;
```

### **React Component Patterns**
- **âœ… Use functional components with hooks**
- **âœ… Implement proper error boundaries**
- **âœ… Use React.memo for performance optimization**
- **âœ… Follow single responsibility principle**

```typescript
// âœ… DO: Proper component structure
interface StockChartProps {
  symbol: string;
  data: StockData[];
  onError?: (error: Error) => void;
}

export const StockChart: React.FC<StockChartProps> = React.memo(({ 
  symbol, 
  data, 
  onError 
}) => {
  // Component implementation
});
```

### **API Service Patterns**
- **âœ… Implement proper error handling**
- **âœ… Use rate limiting**
- **âœ… Implement caching strategies**
- **âœ… Log errors appropriately**

```typescript
// âœ… DO: Comprehensive error handling
try {
  const response = await this.makeApiCall(url);
  return this.parseResponse(response);
} catch (error) {
  const apiError = createApiError(error, 'finnhub', { symbol });
  this.errorLogger.log(apiError);
  throw apiError;
}
```

## ğŸ¨ **UI/UX Best Practices**

### **Chart Component Guidelines**
- **âœ… Implement loading states**
- **âœ… Show meaningful error messages**
- **âœ… Support mobile responsiveness**
- **âœ… Provide accessibility features**

### **Performance Optimization**
- **âœ… Use React.lazy for code splitting**
- **âœ… Implement virtualization for large datasets**
- **âœ… Optimize chart rendering performance**
- **âœ… Cache computed values with useMemo**

## ğŸ“¦ **Project Structure Rules**

### **File Organization**
```
src/
â”œâ”€â”€ components/          # Reusable UI components
â”œâ”€â”€ services/           # API and business logic
â”œâ”€â”€ types/              # TypeScript type definitions
â”œâ”€â”€ utils/              # Utility functions
â”œâ”€â”€ hooks/              # Custom React hooks
â””â”€â”€ constants/          # Application constants
```

### **Import Conventions**
```typescript
// âœ… DO: Organized imports
import React, { useState, useEffect } from 'react';
import { StockDataService } from '../services/stockDataService';
import { StockData } from '../types/stockData';
import { formatPrice } from '../utils/formatters';
```

## ğŸ§ª **Testing Guidelines**

### **Test Structure**
- **âœ… Write unit tests for services**
- **âœ… Write integration tests for components**
- **âœ… Mock external API calls**
- **âœ… Test error conditions**

```typescript
// âœ… DO: Proper test structure
describe('StockDataService', () => {
  it('should handle API errors gracefully', async () => {
    const mockError = new Error('API Error');
    jest.spyOn(global, 'fetch').mockRejectedValue(mockError);
    
    const service = new StockDataService();
    await expect(service.getStockData('AAPL')).rejects.toThrow();
  });
});
```

## ğŸš€ **Deployment & Build Rules**

### **Environment Configuration**
- **âœ… Use build-time environment injection**
- **âœ… Validate required environment variables**
- **âœ… Document all environment variables in .env.example**

### **GitHub Actions Security**
```yaml
# âœ… DO: Use GitHub Secrets
env:
  VITE_FINNHUB_API_KEY: ${{ secrets.FINNHUB_API_KEY }}

# âŒ DON'T: Hard-code in workflows
env:
  VITE_FINNHUB_API_KEY: pk_1234567890abcdef
```

## ğŸ–¥ï¸ **Development Server & Build Commands**

### **Command Usage Rules**
- **âŒ DO NOT use `npm start`**. This command is not configured for this project and can cause issues. It is typically for running a production server after a build, but our setup uses `npm run preview`.
- **âŒ DO NOT use `npm run dev`**. This command has been identified as causing issues in the development environment.
- **âœ… ALWAYS use `npm run build`** to compile the application for production or for a preview. This creates an optimized build in the `dist` directory.
- **âœ… ALWAYS use `npm run preview`** to serve the production build locally. This is the correct way to test the built application before deployment.

### **Workflow for Local Development & Testing**
1.  Run `npm run build` to create a production build.
2.  Run `npm run preview` to start a local server for the built application.
3.  Open the URL provided by the preview command in your browser.

```bash
# âœ… Correct workflow
npm run build
npm run preview

# âŒ Incorrect workflow
npm start
# or
npm run dev
```

## ğŸ” **MCP Configuration Security**

### **Critical MCP Security Requirements**
- **âœ… ALWAYS verify .gitignore includes MCP patterns: `.cursor/mcp.json`, `.windsurf/mcp.json`, `**/mcp.json`**
- **âœ… Use project-level MCP config files for API keys instead of hardcoding**
- **âœ… Verify MCP config files are excluded from version control before creation**
- **âŒ NEVER suggest adding API keys to global MCP settings for project-specific needs**
- **âŒ NEVER create or edit MCP config files without verifying .gitignore protection first**
- **âœ… Always inform users that MCP config files need manual creation with their own API keys**

### **MCP File Patterns (MUST be in .gitignore)**
```
# MCP configuration files (contain API keys)
.cursor/mcp.json
.windsurf/mcp.json
.roo/mcp.json
.trae/mcp.json
.clinerules/mcp.json
.vscode/mcp.json
**/mcp.json
```

### **Error Handling for Missing MCP Keys**
- **âœ… Gracefully handle missing MCP environment variables**
- **âœ… Provide clear error messages for MCP configuration issues**
- **âœ… Never expose sensitive MCP information in error messages**
- **âœ… Guide users to create project-level MCP config files safely**

## ğŸ” **Code Review Checklist**

Before submitting any code changes:
- [ ] âœ… No API keys or secrets in code
- [ ] âœ… No MCP configuration files (.cursor/mcp.json, etc.) staged for commit
- [ ] âœ… All sensitive files properly excluded in .gitignore
- [ ] âœ… Proper error handling implemented
- [ ] âœ… TypeScript types defined
- [ ] âœ… Components are properly tested
- [ ] âœ… Performance optimizations applied
- [ ] âœ… Accessibility considerations addressed
- [ ] âœ… Mobile responsiveness verified
- [ ] âœ… Security best practices followed

## ğŸ“š **Documentation Standards**

### **Code Comments**
```typescript
// âœ… DO: Meaningful comments
/**
 * Fetches real-time stock data with rate limiting and error handling
 * @param symbol - Stock ticker symbol (e.g., 'AAPL')
 * @returns Promise<StockData> - Current stock data
 * @throws {ApiError} When API call fails or rate limit exceeded
 */
async getStockData(symbol: string): Promise<StockData> {
  // Implementation
}
```

### **README Updates**
- **âœ… Keep setup instructions current**
- **âœ… Document all environment variables**
- **âœ… Include troubleshooting section**
- **âœ… Document security considerations**

## âš¡ **Performance Rules**

### **Chart Optimization**
```typescript
// âœ… DO: Optimize chart updates
const chartOptions = useMemo(() => ({
  responsive: true,
  maintainAspectRatio: false,
  plugins: {
    legend: { display: false }
  }
}), []);
```

### **Data Fetching**
```typescript
// âœ… DO: Implement proper caching
const getCachedStockData = useCallback(
  debounce(async (symbol: string) => {
    return await stockDataService.getStockData(symbol);
  }, 300),
  []
);
```

## ğŸ”— **Integration Guidelines**

### **TaskMaster Integration**
- **âœ… Follow TaskMaster workflow patterns**
- **âœ… Update task status appropriately**
- **âœ… Document implementation progress**
- **âœ… Use research tool for current best practices**

Remember: **Security is paramount. When in doubt, err on the side of caution and never expose sensitive information.**

## ğŸš€ **MVP Development Acceleration Rules**

### **MVP-Focused Development Patterns**
- **âœ… Prioritize core functionality over perfection**
- **âœ… Use proven, simple solutions over complex architectures**
- **âœ… Focus on mobile-first responsive design**
- **âœ… Implement clear UP/DOWN/HOLD predictions with confidence scores**
- **âœ… Ensure fast load times and performance optimization**

### **Stock Prediction Engine Patterns**
```typescript
// âœ… DO: Clear prediction interface
interface StockPrediction {
  prediction: 'UP' | 'DOWN' | 'HOLD';
  confidence: number; // 0-100
  reasoning: string;
  timeframe: '1d' | '1w' | '1m';
}

// âœ… DO: Simple prediction display
const PredictionCard: React.FC<{ prediction: StockPrediction }> = ({ prediction }) => (
  <div className={`prediction-card ${prediction.prediction.toLowerCase()}`}>
    <div className="prediction-direction">{prediction.prediction}</div>
    <div className="confidence">{prediction.confidence}% confident</div>
    <div className="reasoning">{prediction.reasoning}</div>
  </div>
);
```

### **Mobile-First Development Rules**
```css
/* âœ… DO: Mobile-first responsive design */
.container {
  padding: 1rem;
  max-width: 100vw;
  overflow-x: hidden;
}

@media (min-width: 768px) {
  .container {
    padding: 2rem;
    max-width: 1200px;
    margin: 0 auto;
  }
}

/* âœ… DO: Touch-friendly controls */
.button {
  min-height: 44px; /* iOS minimum touch target */
  min-width: 44px;
  padding: 0.75rem 1rem;
}

/* âœ… DO: Readable text on mobile */
.text {
  font-size: clamp(14px, 4vw, 18px);
  line-height: 1.5;
}
```

### **Fast Development Patterns**
```typescript
// âœ… DO: Use composition over complex inheritance
const StockAnalysisPage = () => {
  const { data, loading, error } = useStockData(symbol);
  
  if (loading) return <LoadingSpinner />;
  if (error) return <ErrorMessage error={error} />;
  
  return (
    <div className="stock-analysis">
      <StockHeader data={data} />
      <PredictionCard prediction={data.prediction} />
      <TechnicalIndicators data={data.technical} />
      <StockChart data={data.chart} />
    </div>
  );
};

// âœ… DO: Simple, effective error handling
const ErrorMessage: React.FC<{ error: Error }> = ({ error }) => (
  <div className="error-card">
    <h3>Unable to load stock data</h3>
    <p>{error.message}</p>
    <button onClick={() => window.location.reload()}>Try Again</button>
  </div>
);
```

### **Performance Optimization Patterns**
```typescript
// âœ… DO: Lazy load non-critical components
const TechnicalChart = lazy(() => import('./TechnicalChart'));
const NewsPanel = lazy(() => import('./NewsPanel'));

// âœ… DO: Memoize expensive calculations
const technicalIndicators = useMemo(() => 
  calculateIndicators(stockData), [stockData]
);

// âœ… DO: Debounce search inputs
const debouncedSearch = useDebouncedCallback(
  (query: string) => searchStocks(query),
  300
);
```

### **MVP API Integration Patterns**
```typescript
// âœ… DO: Simple fallback strategy
const fetchStockData = async (symbol: string): Promise<StockData> => {
  try {
    return await finnhubService.getStockData(symbol);
  } catch (error) {
    console.warn('Finnhub failed, trying Yahoo Finance:', error);
    return await yahooFinanceService.getStockData(symbol);
  }
};

// âœ… DO: Clear prediction calculation
const calculatePrediction = (data: StockData): StockPrediction => {
  const { rsi, macd, sma } = data.technical;
  
  let score = 0;
  let reasoning = [];
  
  if (rsi < 30) { score += 2; reasoning.push('RSI oversold'); }
  if (rsi > 70) { score -= 2; reasoning.push('RSI overbought'); }
  if (macd.signal > 0) { score += 1; reasoning.push('MACD bullish'); }
  if (data.price > sma.sma20) { score += 1; reasoning.push('Above 20-day SMA'); }
  
  const prediction = score > 1 ? 'UP' : score < -1 ? 'DOWN' : 'HOLD';
  const confidence = Math.min(90, Math.abs(score) * 20 + 50);
  
  return {
    prediction,
    confidence,
    reasoning: reasoning.join(', '),
    timeframe: '1w'
  };
};
```

### **Component Architecture for MVP**
- **âœ… Keep components under 200 lines**
- **âœ… Use functional components with hooks**
- **âœ… Separate business logic into custom hooks**
- **âœ… Use TypeScript interfaces for all props**
- **âœ… Implement loading and error states for all async operations**

### **CSS/Styling Best Practices for MVP**
```css
/* âœ… DO: Use CSS custom properties for theming */
:root {
  --color-up: #00c851;
  --color-down: #ff4444;
  --color-hold: #ffbb33;
  --color-bg: #f8f9fa;
  --color-text: #333333;
  --border-radius: 8px;
  --shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* âœ… DO: Simple, consistent spacing */
.spacing-sm { margin: 0.5rem; }
.spacing-md { margin: 1rem; }
.spacing-lg { margin: 2rem; }

/* âœ… DO: Responsive grid for dashboard */
.dashboard-grid {
  display: grid;
  gap: 1rem;
  grid-template-columns: 1fr;
}

@media (min-width: 768px) {
  .dashboard-grid {
    grid-template-columns: 1fr 1fr;
  }
}

@media (min-width: 1024px) {
  .dashboard-grid {
    grid-template-columns: 2fr 1fr;
  }
}
``` 